# controller_params.yaml
# ROS 层基础配置 - ROS 特有的参数
#
# =============================================================================
# 文件职责
# =============================================================================
#
# 本文件定义 ROS 层特有的基础配置：
# - topics: ROS 话题名称 (默认值)
# - clock: 时钟跳变检测参数
# - transform: TF2 相关配置 (buffer 预热、重试策略、降级检测)
#
# 算法参数 (MPC、约束、安全等) 在平台配置文件中定义。
# 算法内部参数 (滤波器、EKF、状态机逻辑) 在 internal_params.yaml 中定义。
#
# =============================================================================
# 配置加载顺序 (从低到高)
# =============================================================================
#
# 1. universal_controller/config/*.py  - Python 默认配置 (安全网)
# 2. 本文件                             - ROS 层基础配置
# 3. base/internal_params.yaml          - 算法内部参数 (用户不应修改)
# 4. platforms/{platform}.yaml          - 平台特定配置 (用户可调参数)
# 5. ROS 参数服务器                     - 运行时覆盖
#
# =============================================================================
# 配置文件架构
# =============================================================================
#
# controller_ros/config/
# ├── base/
# │   ├── controller_params.yaml    # 本文件: ROS 层基础配置
# │   └── internal_params.yaml      # 算法内部参数 (用户不应修改)
# ├── platforms/
# │   ├── _template.yaml            # 用户配置模板
# │   └── *.yaml                    # 平台配置 (用户可调参数)
# └── tools/
#     └── visualizer_params.yaml    # 可视化工具配置
#


# =============================================================================
# 话题配置 - ROS 层特有
#
# 命名规范:
# - 输入话题: /controller/input/<name>
# - 输出话题: /controller/<name>
# - 空字符串 "" 表示禁用该话题
#
# 平台配置可以覆盖这些默认值
# =============================================================================
topics:
  # 输入话题
  odom: "/controller/input/odom"
  imu: ""                                     # 默认禁用，平台配置中启用
  trajectory: "/controller/input/trajectory"
  emergency_stop: "/controller/emergency_stop"
  
  # 输出话题
  cmd_unified: "/controller/cmd"
  diagnostics: "/controller/diagnostics"
  state: "/controller/state"
  debug_path: "/controller/debug_path"
  attitude_cmd: "/controller/attitude_cmd"    # 仅四旋翼平台


# =============================================================================
# 时钟配置 - 时钟跳变检测参数
#
# 用于检测仿真时间跳变或系统时钟异常。
# 大多数场景使用默认值即可，仅在特殊需求时修改。
# =============================================================================
clock:
  jitter_tolerance: 0.001         # 时钟抖动容忍度 (秒)，小于此值的跳变被忽略
  jump_threshold: 1.0             # 时钟大幅跳变阈值 (秒)，超过此值触发警告
  max_events: 10                  # 最多保留的时钟跳变事件数


# =============================================================================
# TF2 坐标变换配置 - ROS 层特有
#
# 这些参数只在 ROS 环境中使用，Python 算法库中没有对应项。
# 控制 TF2 的 buffer 预热、查询重试、降级检测等行为。
# =============================================================================
transform:
  # ---------------------------------------------------------------------------
  # TF buffer 预热参数
  # 启动时等待 TF 树建立，确保坐标变换可用
  # ---------------------------------------------------------------------------
  buffer_warmup_timeout_sec: 2.0      # TF buffer 预热超时 (秒)，超过则报错
  buffer_warmup_interval_sec: 0.1     # TF buffer 预热检查间隔 (秒)
  
  # ---------------------------------------------------------------------------
  # TF 重试策略 (指数退避)
  # TF 查询失败时的重试机制，避免频繁重试消耗资源
  # ---------------------------------------------------------------------------
  retry_interval_sec: 1.0             # 初始重试间隔 (秒)
  max_retry_interval_sec: 30.0        # 最大重试间隔 (秒)
  backoff_multiplier: 2.0             # 退避倍数 (1s → 2s → 4s → ...)
  max_retries: -1                     # 最大重试次数，-1 表示无限重试
  
  # ---------------------------------------------------------------------------
  # 降级检测参数
  # TF 不可用时的处理策略
  # ---------------------------------------------------------------------------
  fallback_duration_limit_ms: 500     # 降级持续限制 (ms)，超过发出警告
  fallback_critical_limit_ms: 1000    # 临界降级限制 (ms)，超过可能触发安全停止
  
  # ---------------------------------------------------------------------------
  # 延迟补偿参数
  # ---------------------------------------------------------------------------
  max_delay_compensation_sec: 0.5     # 最大延迟补偿时间 (秒)
  
  # ---------------------------------------------------------------------------
  # 坐标系验证
  # 检查源坐标系是否在期望列表中，帮助发现配置错误
  # ---------------------------------------------------------------------------
  expected_source_frames:             # 期望的源坐标系列表
    - "base_link"
    - "base_footprint"
    - "base_link_0"
    - ""
    - "odom"
  warn_unexpected_frame: true         # 对非期望坐标系发出警告
